<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AD-Guard AI | 메타 광고 반려 줄여주는 문구 자동 교정</title>
  <link rel="icon" href="data:,">

  <!-- Pretendard (optional) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css">

  <style>
    :root{
      --bg0:#f6f9ff;
      --bg1:#eef5ff;
      --panel:#ffffff;
      --text:#0b1b3a;
      --muted:#51607a;
      --muted2:#6b7a96;
      --line:#dbe7ff;

      --blue:#2563eb;
      --blue2:#1d4ed8;
      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;

      --radius:16px;
      --shadow: 0 12px 40px rgba(10,30,70,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1000px 500px at 30% 0%, var(--bg1), var(--bg0));
      color:var(--text);
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:24px}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:999px;
      background:rgba(255,255,255,.75); backdrop-filter: blur(8px);
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:800;
      letter-spacing:-.02em;
    }
    .logo{
      width:34px; height:34px; border-radius:12px;
      background: linear-gradient(135deg, var(--blue), #7c3aed);
      box-shadow: 0 10px 30px rgba(37,99,235,.22);
    }
    .nav{
      display:flex; gap:14px; align-items:center;
      color:var(--muted);
      font-weight:600;
    }
    .nav a{padding:8px 10px; border-radius:999px}
    .nav a:hover{background:rgba(37,99,235,.08); color:var(--text)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.9);
      color:var(--muted);
      font-weight:700;
      font-size:13px;
    }
    .hero{padding:34px 0 18px}
    .hgrid{
      display:grid; grid-template-columns: 1.2fr .8fr; gap:22px;
      align-items:stretch;
    }
    @media (max-width: 900px){
      .hgrid{grid-template-columns: 1fr}
    }
    h1{
      margin:14px 0 10px;
      font-size:44px; line-height:1.06;
      letter-spacing:-.04em;
    }
    .sub{
      color:var(--muted);
      font-size:16px; line-height:1.55;
      margin:0 0 16px;
    }
    .ctaRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .btn{
      border:0; cursor:pointer;
      padding:12px 14px; border-radius:14px;
      font-weight:800;
      font-size:14px;
      display:inline-flex; align-items:center; gap:10px;
      box-shadow: 0 10px 30px rgba(10,30,70,.10);
    }
    .btn.primary{background:linear-gradient(135deg, var(--blue), var(--blue2)); color:white}
    .btn.ghost{background:white; border:1px solid var(--line); color:var(--text); box-shadow:none}
    .btn:active{transform:translateY(1px)}
    .card{
      border:1px solid var(--line);
      background:rgba(255,255,255,.92);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      background:linear-gradient(180deg, rgba(37,99,235,.06), rgba(255,255,255,0));
    }
    .cardHead strong{font-size:14px}
    .cardBody{padding:16px}
    .stepList{
      display:grid; gap:10px;
    }
    .step{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:white;
    }
    .num{
      width:26px; height:26px; border-radius:10px;
      display:grid; place-items:center;
      font-weight:900; color:white;
      background:linear-gradient(135deg, var(--blue), #7c3aed);
      flex:0 0 auto;
    }
    .step b{display:block; font-size:13px}
    .step span{display:block; font-size:12px; color:var(--muted); margin-top:2px; line-height:1.4}
    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
    }
    label{display:block; font-weight:800; font-size:12px; margin:0 0 6px}
    input, textarea, select{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:white;
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    textarea{min-height:110px; resize:vertical; line-height:1.5}
    .hint{font-size:12px; color:var(--muted2); margin-top:6px; line-height:1.4}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:white;
      font-weight:800; font-size:12px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .chip[data-on="1"]{border-color: rgba(37,99,235,.35); color:var(--text); background: rgba(37,99,235,.08)}
    .sectionTitle{
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
      margin:18px 0 10px;
    }
    .sectionTitle h2{margin:0; font-size:18px; letter-spacing:-.02em}
    .mini{font-size:12px; color:var(--muted2)}
    .resultGrid{
      display:grid; grid-template-columns: .9fr 1.1fr; gap:14px;
    }
    @media (max-width: 900px){.resultGrid{grid-template-columns:1fr}}
    .scoreBox{
      border:1px solid var(--line);
      border-radius:16px;
      background:white;
      padding:14px;
    }
    .scoreTop{display:flex; align-items:center; justify-content:space-between}
    .badge{
      font-size:12px; font-weight:900;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.92);
    }
    .badge.good{color:var(--good)}
    .badge.warn{color:#a16207}
    .badge.bad{color:var(--bad)}
    .bigScore{
      font-size:44px; font-weight:950; letter-spacing:-.04em; margin-top:6px;
    }
    .reasonList{margin:10px 0 0; padding-left:16px; color:var(--muted); line-height:1.5}
    .reasonList li{margin:4px 0}
    .panel{
      border:1px solid var(--line);
      border-radius:16px;
      background:white;
      padding:14px;
    }
    .panel h3{margin:0 0 10px; font-size:14px}
    .twoCols{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    @media (max-width: 900px){.twoCols{grid-template-columns:1fr}}
    .box{
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(246,249,255,.55);
      padding:10px;
    }
    .boxTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:6px;
    }
    .boxTitle b{font-size:12px}
    .copyBtn{
      border:1px solid var(--line);
      background:white;
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }
    .copyBtn:active{transform:translateY(1px)}
    .mono{white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:13px; line-height:1.5}
    .riskPills{display:flex; gap:8px; flex-wrap:wrap}
    .rp{
      font-size:12px; font-weight:900;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.92);
    }
    .rp.bad{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.07); color:#991b1b}
    .rp.warn{border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.09); color:#92400e}
    .rp.good{border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.09); color:#14532d}
    .foot{
      margin:18px 0 30px;
      color:var(--muted2);
      font-size:12px;
      line-height:1.5;
    }
    .hr{height:1px; background:var(--line); margin:16px 0}
    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>AD-Guard AI</div>
        <span class="pill">FREE · 브라우저에서 즉시 실행</span>
      </div>
      <div class="nav">
        <a href="#start">바로 사용</a>
        <a href="#how">작동 방식</a>
        <a href="#faq">FAQ</a>
      </div>
    </div>

    <section class="hero">
      <div class="hgrid">
        <div>
          <span class="pill">메타 광고 심사 · 반려 사유 번역 · 채널별 복붙 세트</span>
          <h1>메타 광고 반려를 줄여주는<br>문구 자동 교정</h1>
          <p class="sub">
            “왜 반려인지”를 한국어로 납득되게 보여주고, 위험표현을 교정해 <b>통과 확률</b>을 올립니다.<br>
            결과는 <b>점수 + 이유 + 교정 전/후 + 채널별 세트</b>로 한 화면에 정리됩니다.
          </p>
          <div class="ctaRow">
            <a class="btn primary" href="#start">지금 바로 점검하기</a>
            <button class="btn ghost" id="btnRejJump">반려 사유 번역기</button>
          </div>
          <div class="foot">
            * 최종 심사 결과는 Meta 정책/심사 기준 및 업종·랜딩·계정 상태에 따라 달라질 수 있습니다. (통과 “보장”은 불가)
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <strong>한 번에 흐름</strong>
            <span class="pill">“와 좋다” 포인트: 복붙</span>
          </div>
          <div class="cardBody">
            <div class="stepList">
              <div class="step">
                <div class="num">1</div>
                <div>
                  <b>상품/서비스 한 줄</b>
                  <span>뭐를 파는지, 누구에게 필요한지</span>
                </div>
              </div>
              <div class="step">
                <div class="num">2</div>
                <div>
                  <b>타겟·오퍼 + 금지표현 체크</b>
                  <span>심사에서 걸리기 쉬운 표현 자동 탐지</span>
                </div>
              </div>
              <div class="step">
                <div class="num">3</div>
                <div>
                  <b>결과: 점수/리스크/대체문구/채널별 세트</b>
                  <span>IG 본문/헤드라인/설명/랜딩 첫 문장/DM 첫 문장</span>
                </div>
              </div>
              <div class="step">
                <div class="num">+</div>
                <div>
                  <b>반려 사유 번역기</b>
                  <span>메타 반려 메시지 붙여넣기 → 어디를 바꾸면 좋은지 바로 안내</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="start" class="card">
      <div class="cardHead">
        <strong>바로 사용</strong>
        <span class="mini">입력 → 점검/교정 → 복붙</span>
      </div>
      <div class="cardBody">
        <div class="grid">
          <div>
            <label>1) 광고할 상품/서비스 한 줄</label>
            <input id="iProduct" placeholder="예) 인천 서구 1:1 PT — 체형/자세 분석 기반 맞춤 운동" />
            <div class="hint">가능하면 업종/지역/핵심 특징이 들어가면 결과가 좋아집니다.</div>
          </div>

          <div>
            <label>채널</label>
            <select id="iPlatform">
              <option value="meta">메타(인스타/페북)</option>
              <option value="naver">네이버(플레이스/파워링크/블로그)</option>
              <option value="kakao">카카오(채널/톡채널)</option>
              <option value="etc">기타</option>
            </select>
            <div class="hint">기본은 메타 기준으로 점검하고, 채널별 문장 세트를 생성합니다.</div>
          </div>

          <div>
            <label>2) 타겟(누구에게)</label>
            <input id="iTarget" placeholder="예) 운동 초보 / 바쁜 직장인 / 산후 6개월" />
          </div>

          <div>
            <label>오퍼(혜택/조건)</label>
            <input id="iOffer" placeholder="예) 첫 상담 무료 / 2주 체험권 / 20% 할인(기간 한정)" />
          </div>

          <div>
            <label>추가 맥락(선택)</label>
            <input id="iContext" placeholder="예) 통증 치료/완치 같은 표현은 쓰지 말고, ‘도움’ 수준으로" />
            <div class="hint">원하시는 톤(친근/단호/고급)이나 피하고 싶은 단어가 있으면 써주세요.</div>
          </div>

          <div>
            <label>협찬/체험단/인플루언서인가요?</label>
            <div class="row">
              <div class="chip" id="chipDisclosure" data-on="0">예, 표시문구 필요</div>
              <div class="chip" id="chipNoClaims" data-on="1">“보장/확정” 표현 금지</div>
              <div class="chip" id="chipNoSuperlative" data-on="1">“최고/1등” 표현 금지</div>
            </div>
            <div class="hint">체크하면 “표시문구(디스클로저) + 채널별 위치 안내”가 같이 나옵니다.</div>
          </div>

          <div style="grid-column:1/-1">
            <label>3) 현재 광고 문구(붙여넣기)</label>
            <textarea id="iAdText" placeholder="예) 2주 만에 확실히 바뀝니다! 100% 만족 보장. 지금 신청하세요."></textarea>
            <div class="hint">문구가 없으면, 위 입력만으로도 “초안 + 안전 버전 + 채널별 세트”를 만들어드립니다.</div>
          </div>

          <div style="grid-column:1/-1">
            <label>반려 사유 번역기(선택) — 메타 반려 메시지 붙여넣기</label>
            <textarea id="iRej" placeholder="예) Your ad was rejected because it contains misleading claims..."></textarea>
            <div class="hint">반려 메시지를 넣으면, 한국어 해석 + 수정 방향 + 수정본 3개가 같이 나옵니다.</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <button class="btn primary" id="btnRun">심사 통과 점검 & 교정</button>
          <button class="btn ghost" id="btnRej">반려 사유 번역만 보기</button>

          <!-- Optional: AI endpoint -->
          <span class="pill" title="AI 연동은 별도 API(서버/워커)가 필요합니다.">AI 연동: <b id="aiState">OFF</b></span>
        </div>

        <div class="foot">
          * 이 페이지는 “문구” 기준 점검입니다. 심사 결과는 이미지/랜딩/업종/계정 상태까지 함께 영향을 받습니다.
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <div class="cardHead">
        <strong>결과</strong>
        <span class="mini">점수 + 이유 + 교정 전/후 + 복붙 세트</span>
      </div>
      <div class="cardBody">

        <div class="resultGrid">
          <div class="scoreBox">
            <div class="scoreTop">
              <div>
                <div class="mini">통과 가능성 점수(0~100)</div>
                <div class="bigScore" id="rScore">—</div>
              </div>
              <span class="badge" id="rBadge">대기</span>
            </div>
            <div class="hr"></div>
            <div class="mini" style="margin-bottom:6px">리스크 요약</div>
            <div class="riskPills" id="rPills"></div>

            <ul class="reasonList" id="rReasons"></ul>
          </div>

          <div class="panel">
            <h3>교정 전/후</h3>
            <div class="twoCols">
              <div class="box">
                <div class="boxTitle">
                  <b>교정 전</b>
                  <button class="copyBtn" data-copy="#rBefore">복붙</button>
                </div>
                <div class="mono" id="rBefore">—</div>
              </div>
              <div class="box">
                <div class="boxTitle">
                  <b>교정 후(안전 버전)</b>
                  <button class="copyBtn" data-copy="#rAfter">복붙</button>
                </div>
                <div class="mono" id="rAfter">—</div>
              </div>
            </div>

            <div class="hr"></div>

            <h3>반려 사유 번역기</h3>
            <div class="box">
              <div class="boxTitle">
                <b>해석/수정 방향</b>
                <button class="copyBtn" data-copy="#rRejOut">복붙</button>
              </div>
              <div class="mono" id="rRejOut">—</div>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="panel">
          <h3>채널별 “복붙” 세트</h3>
          <div class="twoCols" id="rPack">
            <!-- filled by JS -->
          </div>

          <div class="hr"></div>

          <div id="disclosureWrap" class="panel hidden" style="padding:0; border:none; background:transparent">
            <h3 style="margin-bottom:10px">표시문구(디스클로저) 자동 추천</h3>
            <div class="twoCols" id="rDisclosure"></div>
            <div class="foot">
              * 표기문구는 플랫폼/콘텐츠 형태에 따라 요구가 달라질 수 있습니다. “광고/협찬/유료광고 포함” 등 명확 표기가 안전합니다.
            </div>
          </div>
        </div>

      </div>
    </section>

    <section id="how" class="card" style="margin-top:16px">
      <div class="cardHead">
        <strong>작동 방식</strong>
        <span class="mini">“왜 위험한지”가 보이면 신뢰가 올라갑니다</span>
      </div>
      <div class="cardBody">
        <div class="grid">
          <div class="panel">
            <h3>1) 위험표현 탐지</h3>
            <div class="mini">보장/확정, 과장(최고/1등), 오해 유발(단기간), 민감 업종 리스크 등을 감지합니다.</div>
          </div>
          <div class="panel">
            <h3>2) “왜 위험한지” 설명</h3>
            <div class="mini">반려 사유가 모호해도, 사람이 납득할 문장으로 “문구 리스크”를 번역합니다.</div>
          </div>
          <div class="panel">
            <h3>3) 교정본 + 대체문구</h3>
            <div class="mini">원문을 최대한 유지하면서, 심사에서 걸리기 쉬운 단어를 “안전 표현”으로 바꿉니다.</div>
          </div>
          <div class="panel">
            <h3>4) 채널별 세트</h3>
            <div class="mini">IG 본문/헤드라인/설명/랜딩 첫 문장/DM 첫 문장까지 “복붙” 버튼으로 바로 사용합니다.</div>
          </div>
        </div>
      </div>
    </section>

    <section id="faq" class="card" style="margin-top:16px">
      <div class="cardHead">
        <strong>FAQ</strong>
        <span class="mini">자주 나오는 질문</span>
      </div>
      <div class="cardBody">
        <div class="panel">
          <h3>Q. 메타가 어차피 걸러주는데, 이게 왜 필요하죠?</h3>
          <div class="mini">
            메타 심사는 “통과/반려”만 던지고, 구체 수정 포인트를 친절히 안 알려주는 경우가 많습니다.
            이 도구는 <b>반려 사유 번역 + 교정 전/후 + 대체문구 3종</b>을 한 번에 줘서, 재심사 왕복을 줄이는 게 목적입니다.
          </div>
        </div>
        <div class="panel" style="margin-top:10px">
          <h3>Q. 100% 통과 보장인가요?</h3>
          <div class="mini">
            아닙니다. 심사 결과는 문구뿐 아니라 이미지/랜딩/업종/계정 상태 등 여러 요소가 영향을 줍니다.
            다만 <b>문구로 인한 불필요한 반려</b>를 줄이는 데 집중합니다.
          </div>
        </div>
      </div>
    </section>

    <div class="foot" style="text-align:center">
      © <span id="year"></span> AD-Guard AI. 문구 점검 도구 (실전용)
    </div>
  </div>

  <script>
    // -----------------------------
    // Optional AI hook (production)
    // -----------------------------
    // GitHub Pages는 정적 사이트라 API 키를 숨길 수 없습니다.
    // 실전 AI 교정(LLM)까지 붙이려면, 별도 서버/워커(Cloudflare Workers 등)에 API 키를 저장하고
    // 여기서는 그 엔드포인트만 호출하는 구조가 안전합니다.
    //
    // 아래 값을 채우면 AI ON으로 표시되고, run 시 AI를 우선 사용합니다.
    const AI_ENDPOINT = ""; // 예) https://your-worker.yourname.workers.dev
    const AI_ON = !!AI_ENDPOINT;

    // -----------------------------
    // UI helpers
    // -----------------------------
    const $ = (sel) => document.querySelector(sel);
    const year = new Date().getFullYear();
    $("#year").textContent = year;
    $("#aiState").textContent = AI_ON ? "ON" : "OFF";

    $("#btnRejJump").addEventListener("click", () => {
      $("#iRej").scrollIntoView({behavior:"smooth", block:"center"});
      $("#iRej").focus();
    });

    // chips
    const chipDisclosure = $("#chipDisclosure");
    const chipNoClaims = $("#chipNoClaims");
    const chipNoSuperlative = $("#chipNoSuperlative");

    function toggleChip(el){
      const on = el.getAttribute("data-on") === "1";
      el.setAttribute("data-on", on ? "0" : "1");
    }
    chipDisclosure.addEventListener("click", () => toggleChip(chipDisclosure));
    chipNoClaims.addEventListener("click", () => toggleChip(chipNoClaims));
    chipNoSuperlative.addEventListener("click", () => toggleChip(chipNoSuperlative));

    // copy buttons (event delegation)
    document.addEventListener("click", (e) => {
      const btn = e.target.closest(".copyBtn");
      if(!btn) return;
      const sel = btn.getAttribute("data-copy");
      const el = document.querySelector(sel);
      const text = (el?.innerText || "").trim();
      if(!text) return;
      navigator.clipboard.writeText(text).then(()=>{
        const prev = btn.textContent;
        btn.textContent = "복사됨!";
        setTimeout(()=>btn.textContent = prev, 900);
      });
    });

    // -----------------------------
    // Rule-based analyzer (Free)
    // -----------------------------
    const RISK = [
      { key:"guarantee",  label:"보장/확정", level:"bad",  weight:18, patterns:[/100%/g,/무조건/g,/보장/g,/확실/g,/완치/g,/치료/g,/즉시/g,/단기간/g,/바로\s?효과/g] },
      { key:"super",      label:"최고/1등", level:"warn", weight:12, patterns:[/1등/g,/No\.?1/ig,/최고/g,/유일/g,/국내\s?최초/g,/업계\s?최고/g,/압도적/g] },
      { key:"mislead",    label:"오해 유발", level:"warn", weight:10, patterns:[/절대/g,/무해/g,/부작용\s?없/g,/전부\s?해결/g,/완벽/g] },
      { key:"personal",   label:"개인특성", level:"warn", weight:10, patterns:[/당신은\s?\d+살/g,/뚱뚱한/g,/못생긴/g,/탈모인/g,/우울증/g] },
      { key:"finance",    label:"수익확정", level:"bad",  weight:18, patterns:[/수익\s?보장/g,/원금\s?보장/g,/무조건\s?벌/g,/확정\s?수익/g] },
      { key:"medical",    label:"의료/건강", level:"warn", weight:12, patterns:[/병원급/g,/의학적/g,/처방/g,/약/g,/질병/g,/통증\s?치료/g] },
    ];

    const REWRITE_MAP = [
      [/100%/g, "높은 만족도"],
      [/무조건/g, "상황에 따라"],
      [/보장/g, "도움을 드립니다"],
      [/확실/g, "기대할 수 있습니다"],
      [/완치/g, "개선에 도움"],
      [/치료/g, "케어/관리"],
      [/즉시/g, "빠르게"],
      [/단기간/g, "짧은 기간에도"],
      [/최고/g, "만족도를 높이는"],
      [/1등/g, "선호도가 높은"],
      [/유일/g, "차별화된"],
      [/절대/g, "가능하면"],
      [/부작용\s?없/g, "개인차가 있을 수 있음"],
      [/전부\s?해결/g, "문제 개선에 도움"],
      [/완벽/g, "더 나은"],
      [/수익\s?보장/g, "성과를 목표로"],
      [/원금\s?보장/g, "리스크를 안내하고"],
    ];

    function normalize(s){
      return (s||"").replace(/\s+/g," ").trim();
    }

    function analyzeText(text, opts){
      const t = normalize(text);
      let score = 100;
      const hits = [];

      const noClaims = opts.noClaims;
      const noSuper = opts.noSuper;

      for(const r of RISK){
        // 옵션으로 강화
        if(noClaims && r.key === "guarantee"){}
        if(noSuper && r.key === "super"){}

        let found = false;
        for(const p of r.patterns){
          if(p.test(t)){
            found = true;
            break;
          }
        }
        if(found){
          hits.push(r);
          // 가중치
          let w = r.weight;
          if(noClaims && r.key === "guarantee") w += 6;
          if(noSuper && r.key === "super") w += 4;
          score -= w;
        }
      }

      if(score < 0) score = 0;

      const level = score >= 80 ? "good" : score >= 55 ? "warn" : "bad";

      const reasons = [];
      if(hits.length === 0){
        reasons.push("문구만 기준으로는 큰 위험표현이 많이 보이지 않습니다.");
        reasons.push("그래도 이미지/랜딩/업종 요소에 따라 심사 결과는 달라질 수 있습니다.");
      }else{
        for(const h of hits){
          if(h.key === "guarantee") reasons.push("‘보장/확정/즉시/단기간’ 류 표현은 과장·오해로 분류될 수 있어 반려 리스크가 큽니다.");
          else if(h.key === "super") reasons.push("‘최고/1등/유일/국내최초’ 류 비교·우월 표현은 근거 요구 또는 반려로 이어질 수 있습니다.");
          else if(h.key === "mislead") reasons.push("‘절대/완벽/무해’ 같은 단정 표현은 오해 유발로 판단될 수 있습니다.");
          else if(h.key === "finance") reasons.push("‘수익/원금 보장’은 금융·투자 관련에서 특히 강한 반려 사유가 됩니다.");
          else if(h.key === "medical") reasons.push("의료·건강 효능 단정은 업종/랜딩과 함께 리스크가 커집니다(‘도움’ 수준 표현이 안전).");
          else reasons.push("정책상 민감 표현으로 해석될 수 있는 단어가 포함돼 있습니다.");
        }
      }

      return { score, level, hits, reasons };
    }

    function rewriteText(text){
      let out = text || "";
      for(const [p, rep] of REWRITE_MAP){
        out = out.replace(p, rep);
      }
      // 문장 다듬기(과한 공백/중복)
      out = out.replace(/\s{2,}/g," ").trim();
      return out;
    }

    function buildPack({product, target, offer, afterText, platform}){
      const p = normalize(product) || "상품/서비스";
      const t = normalize(target) || "고객";
      const o = normalize(offer) ? `(${normalize(offer)})` : "";
      const safe = normalize(afterText);

      const baseLanding = `${t}에게 필요한 ${p} — ${o} 자세히 보기`;
      const igBody = safe
        ? safe
        : `${t}분들께 추천드리는 ${p}. ${o} 자세한 내용은 DM 또는 링크에서 확인해 주세요.`;
      const headline = `${p} · ${t} 맞춤`;
      const desc = o ? `${o} 지금 확인` : `지금 확인`;
      const landingFirst = `${t}분들을 위한 ${p}. 과장 없이 핵심만 안내드립니다.`;
      const dmFirst = `${t}님, ${p} 관련해서 간단히 안내드려도 될까요? 원하시는 조건이 있으시면 알려주세요.`;

      return [
        { title:"인스타 광고 본문", text: igBody },
        { title:"헤드라인", text: headline },
        { title:"설명(Description)", text: desc },
        { title:"랜딩 첫 문장", text: landingFirst },
        { title:"DM 첫 문장", text: dmFirst },
      ];
    }

    function translateRejection(msg){
      const m = (msg||"").trim();
      if(!m) return "반려 메시지가 없으면, 아래 점검 결과의 ‘이유’만 참고하시면 됩니다.";

      const rules = [
        { k:/misleading|deceptive|mislead/i, title:"오해/과장(미스리딩)", ko:"과장되거나 오해를 부를 수 있는 문구로 판단될 수 있습니다.", fix:"‘보장/확정/즉시/단기간/완치’ 같은 단정을 줄이고, ‘도움/경험/상황에 따라’ 수준으로 완화하세요." },
        { k:/personal\s+attributes|attributes|you are|your/i, title:"개인 특성(타겟팅) 추정", ko:"사용자의 개인 특성을 단정/추정하는 표현이 문제가 될 수 있습니다.", fix:"‘당신은 OO이죠’ 같은 문장을 빼고, 일반 표현으로 바꾸세요. 예) ‘OO이신 분’ → ‘OO이 고민인 분’" },
        { k:/health|medical|drug|treatment/i, title:"건강/의료 관련", ko:"효능 단정/치료 암시가 심사 리스크를 올립니다.", fix:"질병/치료 단정 대신 ‘관리/케어/도움’ 표현으로 바꾸고, 랜딩에서도 동일 톤을 유지하세요." },
        { k:/unacceptable|business\s+practices/i, title:"비즈니스 관행", ko:"과도한 유인/불명확한 조건/신뢰 요소 부족이 원인일 수 있습니다.", fix:"가격/조건/환불/사업자 정보 등 신뢰 요소를 랜딩에 명확히 넣고, 문구는 과장 없이 안내형으로 바꾸세요." },
        { k:/before\s+and\s+after|before\/after/i, title:"전/후(비포애프터)", ko:"전/후 비교(외모/체형/효과) 뉘앙스는 리스크가 큽니다.", fix:"전/후 직접 비교 표현과 이미지를 피하고, 과정/서비스 설명 중심으로 변경하세요." },
      ];

      let pick = null;
      for(const r of rules){
        if(r.k.test(m)){ pick = r; break; }
      }
      if(!pick){
        return [
          "반려 메시지(원문) 요약:",
          m.slice(0, 400) + (m.length>400 ? "…" : ""),
          "",
          "수정 방향(보편적으로 안전한 조치):",
          "- ‘보장/확정/즉시/단기간/1등/최고’ 같은 단정·우월 표현 제거",
          "- 효능/결과는 ‘도움/개선 기대/개인차’ 수준으로 완화",
          "- 랜딩(첫 문장)도 같은 톤으로 맞추기",
        ].join("\n");
      }

      return [
        `판단 유형: ${pick.title}`,
        `해석: ${pick.ko}`,
        `어떻게 바꾸면 좋나: ${pick.fix}`,
      ].join("\n");
    }

    function renderResult(payload){
      const {score, level, hits, reasons, before, after, pack, rejOut, disclosureOn} = payload;

      $("#rScore").textContent = score.toString();

      const badge = $("#rBadge");
      badge.className = "badge " + (level === "good" ? "good" : level === "warn" ? "warn" : "bad");
      badge.textContent = level === "good" ? "통과 가능성 높음" : level === "warn" ? "주의 필요" : "반려 위험 높음";

      // pills
      const pills = $("#rPills");
      pills.innerHTML = "";
      if(!hits || hits.length === 0){
        pills.innerHTML = `<span class="rp good">큰 위험표현 없음</span>`;
      }else{
        for(const h of hits){
          const c = h.level === "bad" ? "bad" : h.level === "warn" ? "warn" : "good";
          const el = document.createElement("span");
          el.className = "rp " + c;
          el.textContent = h.label;
          pills.appendChild(el);
        }
      }

      // reasons
      const ul = $("#rReasons");
      ul.innerHTML = "";
      (reasons||[]).slice(0,6).forEach(r=>{
        const li = document.createElement("li");
        li.textContent = r;
        ul.appendChild(li);
      });

      $("#rBefore").textContent = before || "—";
      $("#rAfter").textContent = after || "—";
      $("#rRejOut").textContent = rejOut || "—";

      // pack
      const packWrap = $("#rPack");
      packWrap.innerHTML = "";
      (pack||[]).forEach(item=>{
        const box = document.createElement("div");
        box.className = "box";
        box.innerHTML = `
          <div class="boxTitle">
            <b>${item.title}</b>
            <button class="copyBtn" data-copy="#x_${cssSafeId(item.title)}">복붙</button>
          </div>
          <div class="mono" id="x_${cssSafeId(item.title)}"></div>
        `;
        packWrap.appendChild(box);
        box.querySelector(".mono").textContent = item.text;
      });

      // disclosure
      const dWrap = $("#disclosureWrap");
      if(disclosureOn){
        dWrap.classList.remove("hidden");
        const d = $("#rDisclosure");
        d.innerHTML = "";
        const items = buildDisclosureSet();
        items.forEach(it=>{
          const box = document.createElement("div");
          box.className = "box";
          box.innerHTML = `
            <div class="boxTitle">
              <b>${it.title}</b>
              <button class="copyBtn" data-copy="#d_${cssSafeId(it.title)}">복붙</button>
            </div>
            <div class="mono" id="d_${cssSafeId(it.title)}"></div>
            <div class="hint">${it.hint}</div>
          `;
          d.appendChild(box);
          box.querySelector(".mono").textContent = it.text;
        });
      }else{
        dWrap.classList.add("hidden");
      }

      // scroll to results
      $("#rScore").scrollIntoView({behavior:"smooth", block:"center"});
    }

    function cssSafeId(s){
      return (s||"").replace(/[^a-zA-Z0-9가-힣]+/g,"_");
    }

    function buildDisclosureSet(){
      return [
        {
          title:"인스타 피드/릴스 표시문구",
          text:"광고 · 협찬을 받아 작성했습니다.",
          hint:"권장 위치: 본문 첫 줄 또는 해시태그 앞"
        },
        {
          title:"스토리 표시문구",
          text:"유료광고 포함",
          hint:"권장 위치: 스토리 상단에 고정(잘 보이게)"
        },
        {
          title:"블로그 표시문구",
          text:"업체로부터 제품/서비스를 제공받아 작성한 후기입니다.",
          hint:"권장 위치: 글 서두(첫 단락) + 하단 1회"
        },
        {
          title:"유튜브 설명란 표시문구",
          text:"본 영상은 유료광고/협찬을 포함하고 있습니다.",
          hint:"권장 위치: 설명란 상단"
        },
      ];
    }

    async function callAI(input){
      // AI endpoint expects JSON and returns our schema
      const res = await fetch(AI_ENDPOINT, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify(input)
      });
      if(!res.ok){
        const t = await res.text().catch(()=> "");
        throw new Error(`AI error: ${res.status} ${t}`);
      }
      return await res.json();
    }

    function getInputs(){
      return {
        product: $("#iProduct").value,
        platform: $("#iPlatform").value,
        target: $("#iTarget").value,
        offer: $("#iOffer").value,
        context: $("#iContext").value,
        adText: $("#iAdText").value,
        rejectionMessage: $("#iRej").value,
        disclosureOn: chipDisclosure.getAttribute("data-on")==="1",
        noClaims: chipNoClaims.getAttribute("data-on")==="1",
        noSuperlative: chipNoSuperlative.getAttribute("data-on")==="1",
      };
    }

    function runLocal(){
      const inp = getInputs();

      const base = inp.adText && normalize(inp.adText) ? normalize(inp.adText) : `${normalize(inp.target)||"고객"}분들께 필요한 ${normalize(inp.product)||"상품/서비스"}. ${normalize(inp.offer)||""}`.trim();
      const analysis = analyzeText(base, { noClaims: inp.noClaims, noSuper: inp.noSuperlative });
      const after = rewriteText(base);

      const pack = buildPack({
        product: inp.product,
        target: inp.target,
        offer: inp.offer,
        afterText: after,
        platform: inp.platform
      });

      const rejOut = translateRejection(inp.rejectionMessage);

      renderResult({
        score: analysis.score,
        level: analysis.level,
        hits: analysis.hits,
        reasons: analysis.reasons,
        before: base,
        after,
        pack,
        rejOut,
        disclosureOn: inp.disclosureOn
      });
    }

    async function run(){
      const inp = getInputs();

      // If AI is ON, try AI first; fallback to local
      if(AI_ON){
        try{
          const out = await callAI(inp);
          // out should already match our UI fields
          // But if the endpoint returns different, fall back
          if(out && typeof out.score === "number"){
            renderResult({
              score: out.score,
              level: out.level || (out.score>=80?"good":out.score>=55?"warn":"bad"),
              hits: out.hits || [],
              reasons: out.reasons || [],
              before: out.before || inp.adText || "—",
              after: out.after || "—",
              pack: out.pack || [],
              rejOut: out.rejOut || translateRejection(inp.rejectionMessage),
              disclosureOn: inp.disclosureOn
            });
            return;
          }
        }catch(e){
          console.warn(e);
        }
      }
      runLocal();
    }

    $("#btnRun").addEventListener("click", run);

    $("#btnRej").addEventListener("click", () => {
      const msg = $("#iRej").value;
      $("#rRejOut").textContent = translateRejection(msg);
      $("#rRejOut").scrollIntoView({behavior:"smooth", block:"center"});
    });

    // First render
    renderResult({
      score: 0,
      level: "warn",
      hits: [],
      reasons: ["위 입력을 채우고 버튼을 눌러주세요."],
      before: "—",
      after: "—",
      pack: [],
      rejOut: "—",
      disclosureOn: false
    });
  </script>
</body>
</html>
